#!/bin/bash
if [[ -z "$1" ]]
then
exit 0
fi
if [[ "$1" == "/?" || "$1" == "-h" || "$1" == "--help" ]]
then
echo "Usage: $0 <domain_name>"
echo "Example: girlsgonewild.com"
exit 0
fi
touch /etc/captiveportal/blockedzone.conf
touch /etc/captiveportal/named.conf.footer0
if [[ ! -f "/etc/captiveportal/sites.override" ]]
then
cat <<EOF > /etc/captiveportal/sites.override
:This section contains sites will not be blocked
:until its removed from this list
:This is usefull when you want to update a hosts
:database and not have to worry about it reblocking
:that site again. Anylines containing colons are comments
EOF
fi
DOMAIN=$1
if [[ "$DOMAIN" == *":"* ]]
then
echo "Only website names can be blocked."
exit 1
fi
cat /etc/captiveportal/named.conf.footer0 | grep -q "^zone \"$DOMAIN\""
if [[ $? -eq 0 ]]
then
echo "$DOMAIN: Already blocked"
exit 3
fi
cat /etc/captiveportal/sites.override | grep -q "^$DOMAIN"
if [[ $? -eq 0 ]]
then
echo "$DOMAIN is in the override list"
exit 0
fi
echo "zone \"$DOMAIN\" { type master; file \"/etc/bind/db.catchall\"; allow-query { any; }; };" >> /etc/captiveportal/named.conf.footer0
echo "$1: website successfully blocked"
if [[ -z "$DNSRESETHINT" ]]
then
echo "Type sudo hosts-build to apply changes"
fi
